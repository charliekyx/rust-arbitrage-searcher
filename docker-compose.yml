name: arbitrage-bot-prod

services:
  bot:
    build: .
    container_name: rust-arb-bot
    restart: unless-stopped

    # 你的代码逻辑会读取环境变量 CONFIG_PASS 来解密配置
    # 请确保 .env 文件里有 CONFIG_PASS=你的设定密码
    env_file:
      - .env

    # 设置日志级别
    environment:
      - RUST_LOG=info
      - IPC_PATH=/app/geth_data/geth.ipc

    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # 网络优化：直接使用宿主机网络堆栈，减少延迟
    network_mode: "host"

    volumes:
      - ./mev_bot.secure:/app/mev_bot.secure:ro
      - ./data/gas_state.json:/app/gas_state.json
      - ./data/trades.jsonl:/app/trades.jsonl
      - /home/ubuntu/node/data/geth:/app/geth_data ## ipc config
      - ./pools.json:/app/pools.json
